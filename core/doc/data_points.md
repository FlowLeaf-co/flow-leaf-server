# Data Points

A data point represents a value at a specific point in time. In this project a standard data point also has context and type information. This is best shown with the examples below:

| Time (pk)                        | Value | Data Point Type   | Peripheral Component |
| -------------------------------- | ----- | ----------------- | -------------------- |
| 2020-12-15T14:56:28.538743+00:00 | 0.1   | FK to temperature | FK to BME280_A       |
| 2020-12-15T14:58:28.538744+00:00 | 8     | FK to humidity    | FK to BME280_A       |
| 2020-12-15T14:59:39.611047+00:00 | 0     | FK to temperature | FK to BME280_B       |
| 2020-12-15T14:59:39.611048+00:00 | 7.2   | FK to humidity    | FK to BME280_B       |

The first thing to note is that the primary key is given by the time. This is due to the limitation of compound primary keys in Django. In the case of a collision, the timestamp is smeared by a microsecond until it succeeds. In addition, the time is set either when the data point is created or when received by the server. The value is stored as a double precision IEEE 754 float.

To give the data point context, a foreign key to the data point type (DPT) is stored. The DPT is user customizable, so that differentiations between water and air temperature can be made, for example. In addition, the peripheral that corresponds to that data point is also stored. The data point may be a measurement generated by the peripheral, or a target value for the peripheral, as is the case for actuators, such as motors and lights.

## Peripheral to Data Point Type Relation

A peripheral may be configured to accept or create data points with varying DPTs. In order for the controller to be able to differentiate the DPTs during its setup, a prefix may be added to the parameter name. Three examples of peripheral setup parameters are given below:

| Peripheral    | Parameter name              | Value                              |
| ------------- | --------------------------- | ---------------------------------- |
| LED           | pin                         | 22                                 |
|               | data_point_type             | *[uuid of brightness % DPT]*       |
| I2C Adapter   | scl_pin                     | 16                                 |
|               | sda_pin                     | 17                                 |
| BMP280 Sensor | i2c_adapter                 | *[uuid of I2C adapter peripheral]* |
|               | temperature_data_point_type | *[uuid of temperature DPT]*        |
|               | pressure_data_point_type    | *[uuid of pressure DPT]*           |

In the case of the LED, when receiving brightness commands, the data point has to have a value and a corresponding DPT. The I2C adapter peripheral does not create or accept data points and therefore does not have a corresponding parameter. The BMP280 creates multiple types of data points and therefore has multiple parameters corresoponding to different DPTs.

Internally, the parameter names are derived from a parameter prefix that is stored in the many-to-many relationship between peripherals and DPTs within an intermediate model / table.